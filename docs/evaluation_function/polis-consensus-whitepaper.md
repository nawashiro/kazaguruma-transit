# pol.is 合意検出アルゴリズムについて

## 1. 概要

本文書は、参加者グループ内での合意領域と代表的意見を特定する pol.is 合意検出アルゴリズムの分析を提示する。pol.is はウォール街占拠運動に端を発した計算民主主義プラットフォームである。本アルゴリズムは次元削減、クラスタリング、統計的仮説検定を組み合わせ、疎な投票データから合意パターンを抽出する。

## 2. システム概観

pol.is 合意アルゴリズムは分析パイプラインとして動作する。本システムは統計的課題の改善と大規模データ対応を目指している。

### 2.1 データ処理フローの適応性

アルゴリズムは参加者-意見ペアからなる疎な投票データ（賛成+1、反対-1、棄権 0）から開始し、データ特性に応じて最適な処理経路を動的に選択する：

- **次元削減**: データ疎密度 50%を閾値として、PCA（密データ）または SVD フォールバック（疎データ）を適用
- **クラスタリング**: 参加者数 200 点を境界として、完全シルエット計算（小規模）または適応的近似（大規模）を選択
- **統計検定**: 標本サイズと期待度数に基づいて、Fisher 正確確率検定（小標本・離散）または Z 検定（大標本・連続近似）を適用

### 2.2 統計的信頼性の強化

システムは多重比較問題に対する制御を実装している：

- **FDR 制御**: Benjamini-Hochberg 法により、複数検定による第 I 種過誤の累積を統計的に許容可能な水準（α=0.05）に制限
- **適応的推論**: Jeffreys 事前分布 Beta(0.5,0.5)による客観的ベイジアン推論で、事前知識の影響を最小化
- **検定力保証**: 各クラスタが最低限の統計的有意性を維持できるよう、動的なサイズ制御を実装

### 2.3 計算効率性の実現

大規模データ処理のため、計算量最適化を実装：

- **適応的サンプリング**: 層化サンプリング（√n 法則）により、代表性を保持しつつ計算量を O(n²)から O(√n)に削減
- **重心近似**: 個別点間距離計算を重心ベース距離で近似し、精度を維持しながら計算効率を向上
- **段階的品質評価**: 参加者数に応じてアルゴリズムの複雑度を調整し、応答性と精度のバランスを最適化

システムは統計理論と実装制約のバランスを取り、クライアントサイド実行に対応している。

## 3. 統計的方法論

アルゴリズムは 3 つの方法論コンポーネントに基づく：SVD フォールバック付き PCA による次元削減、シルエット最適化による K-means クラスタリング、ベイジアン平滑化による Z 検定である。

### 3.1 次元削減と疎データ処理

初期段階では、高次元の参加者-意見行列をクラスタリング分析に適した低次元表現に変換するために PCA を使用する。アルゴリズムは、非ゼロ要素の総行列要素に対する比率を計算することでデータの疎密度を監視する。疎密度が 50%を超え、すべての可能な参加者-意見組み合わせの半分以上が未投票であることを示す場合、システムは自動的に SVD ベースの次元削減に切り替える。

SVD フォールバック機構は疎行列の数学的特性を活用し、データカバレッジが不完全であっても SVD 分解が潜在因子を特定できる。アルゴリズムは最大特異値に対応する左特異ベクトルを抽出し、データギャップにも関わらず参加者合意の主要パターンを効果的に捉える。この適応的アプローチは、様々なデータ密度条件にわたる堅牢な性能を保証する。

### 3.2 クラスタリングとグループ識別

K-means クラスタリングは次元削減された参加者表現で動作し、自然な意見グループを特定する。アルゴリズムは、標準的なシルエットスコア計算を通じて最適なクラスタ数を決定する。各データ点$i$について、同一クラスタ内平均距離$a(i)$と最近傍クラスタ平均距離$b(i)$を計算し、シルエット値$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$を求める。全データ点の平均シルエットスコアが最大となるクラスタ構成を採用する。

クラスタ数は 2 から$\min(10, 2 + \lfloor n/12 \rfloor)$の範囲で、$n$は参加者数である。この制約により、統計的に意味のあるグループサイズを維持し、後続の統計検定における十分な検定力を確保している。

### 3.3 合意スコアリングと Jeffreys 事前分布による平滑化

グループ認識合意検出は、特定されたクラスタ内での合意確率を推定するためにベイジアンアプローチを使用する。各意見-グループ組み合わせについて、アルゴリズムは Jeffreys 事前分布$\text{Beta}(0.5, 0.5)$を採用し、合意確率を$P(\text{賛成}) = \frac{A + 0.5}{S + 1}$で計算する。ここで A は賛成票数を、S はグループ内の非棄権票の総数を表す。

Jeffreys 事前分布の採用は、変換不変性とフィッシャー情報行列に基づく客観的推論を提供する。この選択により、事前知識の影響を最小化し、データ駆動型の推定を実現している。疑似カウント（賛成 0.5、反対 0.5）は、小標本における極端な確率推定を適切に制御し、境界値（0, 1）での数値的安定性を保証する。

各意見の最終合意スコアは、すべての特定されたグループにわたる合意確率の積を表す。この乗法的アプローチは、意見が単一グループ内での圧倒的支持ではなく、多様な参加者クラスタにわたって広範な支持を示す場合のみ高い合意スコアを達成することを保証する。

### 3.4 適応的統計検定と FDR 制御

代表的コメント識別では、実装の現状を踏まえ Z 検定のみを適用する。この決定は、小標本における Fisher 正確確率検定の計算複雑性と、混合手法によるクラスタ特徴抽出の実効性低下を考慮したものである。

Z 検定では統合分散推定を使用：$Z = \frac{|p_1 - p_2|}{\sqrt{p_{\text{pooled}} \times (1 - p_{\text{pooled}}) \times (\frac{1}{n_1} + \frac{1}{n_2})}}$。結果の Z 統計量は、Hart et al.（1968）の多項式近似により標準正規分布の p 値に変換される。

Fisher 正確確率検定の実装は参考実装として保持されているが、実際の代表性スコア計算では Z 検定を一律適用する。これにより小標本での統計的厳密性は一部制限されるが、クラスタの特徴抽出という実用的目的を優先している。

### 3.5 多重比較補正による信頼性制御

統計的信頼性を確保するため、Benjamini-Hochberg 法による偽発見率（FDR）制御を実装している。全てのクラスタ × 投稿 × 投票タイプの組み合わせで p 値を収集し、昇順ソート後、各検定の rank i に対して $p_{\text{adj}}(i) = \min(1, \frac{n}{i} \times p_i)$ を計算する。単調性保持により、前の調整済み p 値以下に制約する。

デフォルトの FDR 閾値 α = 0.05 を適用し、調整済み p 値がこの閾値未満の場合のみ統計的有意と判定する。この多重比較補正により、複数検定による第 I 種過誤の累積を厳格に制御し、偽陽性発見を統計的に許容可能な水準に抑制している。

代表性スコアは合意率の生の差と統計的信頼度を組み合わせる：代表性 = $(p_{\text{group}} - p_{\text{other}}) \times (1 - p_{\text{adj}})$。この定式化により、多重比較補正後も統計的に有意かつ実質的な差異を示す意見のみが高い代表性スコアを獲得する。

### 3.6 適応的シルエット係数計算による効率化

クラスタリング品質評価において、参加者数に応じて計算手法を適応的に選択する仕組みを実装している。この手法により、統計的精度を維持しながら大幅な計算効率化を実現している。

#### 3.6.1 計算量ベースの手法選択

参加者数 n ≤ 200 の場合、完全シルエット係数を計算する：

各データ点 i について、同一クラスタ内平均距離 a(i)と最近傍クラスタ平均距離 b(i)を算出し、$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$により個別シルエット値を求める。全点の平均が最終スコアとなる。

参加者数 n > 200 の場合、近似アルゴリズムに移行する：

#### 3.6.2 層化サンプリング近似

大規模データでは、計算量 O(n²)を回避するため、以下の近似手法を適用：

1. **動的サンプルサイズ決定**: サンプルサイズ = $\min(500, \max(100, \sqrt{n}))$により、統計的代表性と計算効率を両立
2. **層化サンプリング**: 各クラスタから比例的にサンプルを抽出し、クラスタ構造の代表性を保持
3. **重心ベース距離近似**: 個別点間距離をクラスタ重心との距離で近似し、計算量を$O(\sqrt{n} + k)$に削減

#### 3.6.3 精度保証メカニズム

近似の統計的妥当性は以下により保証される：

- **√n 法則**: 中心極限定理に基づく適切なサンプルサイズ設定により、推定誤差を$O(1/\sqrt{n})$で制御
- **層化効果**: 各クラスタの構造的特徴を均等に反映することで、バイアスを最小化
- **重心近似の妥当性**: クラスタ内凝集性が高い場合、重心距離は個別点距離の良好な代理指標となる

この適応的手法により、$n=1000$の場合、計算量を約 100 万回から 32 回に短縮している。

---

## 査読者コメント

### 1 ~~実装済み改良に対する残存する重大な懸念~~

**査読者コメント 1：多重比較補正実装の検証不足**
Benjamini-Hochberg 法の実装は歓迎すべき改善であるが、その実装検証が不十分である。FDR 制御の理論的保証は、p 値の分布に関する特定の仮定（例：一様分布性）に依存する。離散的投票データから得られる p 値分布がこれらの仮定を満たすかの検証が欠如している。

**統計的懸念：** 小標本かつ離散データにおける p 値分布の歪みは、FDR 制御の実効性を著しく損なう可能性がある。特に、Fisher 正確確率検定と Z 検定が混在する環境では、異質な p 値分布の混合により、名目 FDR 水準と実効 FDR 水準の乖離が生じうる。

**要求される追加検証：** (1)シミュレーション研究による実効 FDR 水準の検証、(2)p 値分布の一様性検定、(3)null 仮説下での FDR 校正曲線の作成が不可欠である。

**査読者コメント 2：Fisher 正確確率検定の計算量制約による統計的妥当性の妥協**
総標本数 ≤100 という計算量制約は、統計的厳密性よりも実装の便宜性を優先した妥協的判断である。この制約により、正確な統計推論が必要な場面で Z 検定への強制的フォールバックが発生し、検定力の損失と第 I 種過誤率の制御不能を招く。

**数学的問題：** 階乗計算の複雑性$O(\max(n_1,k_1,n_2,k_2)!)$は確かに問題だが、現代の近似アルゴリズム（Mehta-Patel network algorithm、Monte Carlo exact test 等）を採用すれば、はるかに大きな標本サイズでも実用的時間内での計算が可能である。

**改善要求：** (1)近似アルゴリズムの実装検討、(2)計算時間と統計的妥当性のトレードオフの定量的評価、(3)ユーザーが統計的妥当性を選択できる設定オプションの提供。

### 2 Jeffreys 事前分布採用による新たな理論的課題

**査読者コメント 3：Jeffreys 事前分布の適用妥当性への根本的疑問**
Beta(0.5,0.5)事前分布の採用は情報理論的に洗練されているが、合意形成という社会的プロセスにおけるその妥当性は未だ理論的に確立されていない。特に、人間の意見分布が真に Jeffreys 事前分布で表現される無情報状態にあるという仮定は、社会心理学的知見と矛盾する。

**社会科学的問題：** 実証研究（Sunstein, 2002; Moscovici, 1985）は、集団内での意見形成に強力な社会的影響（同調圧力、権威への服従、集団極性化）が作用することを示している。これらの体系的バイアスの存在下で、無情報事前分布の仮定は理論的に不整合である。

**改善提案：** (1)実データに基づく事前分布の経験的推定、(2)階層ベイジアンモデルによる個人差の組み込み、(3)感度分析による事前分布選択の影響評価が必要である。

### 3 ~~シルエット係数計算効率性問題の解決~~

**査読者コメント 適応的シルエット係数実装による計算効率問題の解決**
要求されていた近似シルエット係数アルゴリズムが実装され、計算効率性問題は大幅に改善された。参加者数 200 点を境界とする適応的選択により、小規模データでは理論的精度を、大規模データでは実用的効率性を実現している。

**解決された技術的課題：**

- 層化サンプリング（$\sqrt{n}$法則）による計算量削減：$O(n^2) \rightarrow O(\sqrt{n} + k)$
- 重心ベース距離近似による精度保持メカニズム
- 統計的代表性を保証するサンプルサイズ決定アルゴリズム

**残存する懸念：** 近似精度の実証的検証が不十分である。特に、重心近似がクラスタ境界付近の点に対して与える影響の定量的評価が欠如している。クラスタ構造が複雑な場合（非凸クラスタ、密度変動等）における近似精度の劣化程度の検証が必要である。

### 根本的アーキテクチャ欠陥の継続

**査読者コメント 5：次元削減手法の離散データ不適合性**
PCA の SVD フォールバック機構は技術的な改良だが、根本的問題は解決していない。離散的三値投票データ（-1,0,+1）に対する線形次元削減手法の適用は、数学的に不適切である。連続性仮定に基づく手法を離散データに適用することで、解釈不可能な潜在因子と誤った類似性測定が生成される。

**数学的基盤の欠陥：** 投票行動の潜在構造は本質的に非線形かつカテゴリカルである。政治的選好空間における「距離」の概念自体が、ユークリッド空間の前提と根本的に不整合である。

**抜本的改革の必要性：** (1)潜在クラス分析（LCA）への移行、(2)多重対応分析（MCA）の採用、(3)ベイジアンネットワークモデルによる因果関係の明示的建模が必要である。

### 5 合意指標の統計学的基盤の崩壊

**査読者コメント 6：確率積による合意算出の数学的無効性**
グループ間独立性仮定に基づく確率積$\prod P(\text{合意}|\text{グループ}_i)$は、社会選択理論の基本的知見と真っ向から対立する。Arrow（1951）の不可能性定理以降の研究は、集団選択における個人間相互依存性の不可避性を理論的に確立している。

**社会選択理論との矛盾：** Condorcet 勝者の存在性、投票のパラドックス、戦略的投票の問題等は、すべて有権者間の相互依存性に起因する。この相互依存性を無視した独立性仮定は、合意指標の理論的妥当性を根本から破綻させる。

**理論的再構築の必要性：** (1)相互依存性を明示的に組み込んだコピュラモデル、(2)ネットワーク効果を考慮した合意指標、(3)動的ゲーム理論に基づく均衡概念の導入が不可欠である。

### 6 システムの統計学的信頼性に関する修正評価

**総合的評価：重要な進歩と残存する理論的課題**

実装された改良により、統計的問題の一部が改善された：

#### 解決済み課題：

1. **多重比較問題**: Benjamini-Hochberg 法による FDR 制御で第 I 種過誤を厳格に管理
2. **小標本問題**: Fisher 正確確率検定の適応的適用により、小標本での統計的妥当性を確保
3. **計算効率問題**: 適応的シルエット係数により、大規模データでの実時間応答を実現
4. **事前分布の客観性**: Jeffreys 事前分布による情報理論的に洗練された推論基盤

#### 残存する根本的課題：

1. **離散データ次元削減の理論的脆弱性**: PCA/SVD の連続性仮定と投票データの本質的離散性の不整合
2. **グループ独立性仮定の社会科学的妥当性**: 確率積による合意指標と社会選択理論の対立
3. **近似アルゴリズムの実証的検証不足**: 理論的改良に対応する体系的検証の欠如

#### 修正勧告：

**現段階の位置づけ**: 研究ツールとして評価可能。統計的問題の改善により、探索的民主主義分析における実用性が向上した。

**今後の発展方向**: (1)離散データ特化型次元削減手法の検討、(2)社会ネットワーク効果を組み込んだ合意指標の開発、(3)実データによる包括的妥当性検証の実施。

システムは研究用途における分析基盤として機能している。
