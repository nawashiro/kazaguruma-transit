# pol.is にインスピレーションを受けた合意検出アルゴリズムについて

## 1. 概要

本文書は、pol.is にインスピレーションを受けた参加者グループ内での合意領域と代表的意見を特定する合意検出アルゴリズムの分析を提示するものである。本アルゴリズムは次元削減、クラスタリング、統計的仮説検定を組み合わせ、疎な投票データから合意パターンの抽出を試みる。

## 2. システム概観

合意アルゴリズムは統合された分析パイプラインとして動作する。

### 2.1 データ処理フローの適応性

アルゴリズムは参加者と意見のペアで構成される疎な投票データを基礎として開始する。各投票は賛成（+1）、反対（-1）、棄権（0）で表現される。システムはデータの特性を動的に評価し、最適な処理経路を選択する。

次元削減の段階では、データ密度 50%を閾値として、密データに対しては PCA を、疎データに対しては SVD フォールバックを適用する。

クラスタリングにおいては、参加者数 200 点を境界として、小規模データセットには完全シルエット計算を、大規模データセットには適応的近似手法を選択する。統計検定では、Mehta & Patel（1983）による Network Algorithm を使用して Fisher 正確確率検定の近似を実行する。

### 2.2 統計的信頼性の強化

システムは多重比較問題に対する制御を実装している。FDR 制御では、Benjamini-Hochberg 法を採用し、複数検定による第 I 種過誤の累積を統計的に許容可能な水準（α=0.05）に制限している。適応的推論においては、Jeffreys 事前分布 Beta(0.5,0.5)を用いた客観的ベイジアン推論により、事前知識の影響を最小化している。検定力保証として、各クラスタが最低限の統計的有意性を維持できるよう、動的なサイズ制御を実装している。

### 2.3 計算効率性の実現

大規模データ処理において計算量最適化を実現している。適応的サンプリングでは、層化サンプリング手法（√n 法則）を採用し、代表性を保持しながら計算量を O(n²)から O(√n)に削減している。

重心近似においては、個別点間距離計算を重心ベース距離で近似することで、精度を維持しながら計算効率を向上させている。段階的品質評価では、参加者数に応じてアルゴリズムの複雑度を調整し、応答性と精度のバランスを最適化している。

このシステム設計により、統計理論と実装制約のバランスを実現し、クライアントサイド実行に対応している。

## 3. 統計的方法論

このアルゴリズムは三つの主要な方法論コンポーネントによって構成されている。第一は、SVD フォールバック機構を持つ PCA による次元削減である。第二は、シルエット最適化による K-means クラスタリングである。第三は、Mehta & Patel（1983）の Network Algorithm を用いた Fisher 正確確率検定の近似である。

アルゴリズムは二種類のスコアを算出する。合意スコアは複数のクラスタにわたって共通する見解を特定する役割を果たす。代表性スコアは特定のクラスタ内において代表的な見解を特定する。

### 3.1 次元削減と疎データ処理

初期段階では、高次元の参加者-意見行列をクラスタリング分析に適した低次元表現に変換するために PCA を使用する。アルゴリズムは、非ゼロ要素の総行列要素に対する比率を計算することでデータ密度を監視する。データ欠損率が 50%を超え、すべての可能な参加者-意見組み合わせの半分以上が未投票であることを示す場合、システムは自動的に SVD ベースの次元削減に切り替える。

SVD フォールバック機構は疎行列の数学的特性を活用し、データカバレッジが不完全であっても SVD 分解が潜在因子を特定できる。アルゴリズムは最大特異値に対応する左特異ベクトルを抽出し、データギャップにも関わらず参加者合意の主要パターンを効果的に捉える。この適応的アプローチは、様々なデータ密度条件にわたる堅牢な性能を保証する。

### 3.2 クラスタリングとグループ識別

K-means クラスタリングは次元削減された参加者表現で動作し、自然な意見グループを特定する。アルゴリズムは、標準的なシルエットスコア計算を通じて最適なクラスタ数を決定する。各データ点$i$について、同一クラスタ内平均距離$a(i)$と最近傍クラスタ平均距離$b(i)$を計算し、シルエット値$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$を求める。全データ点の平均シルエットスコアが最大となるクラスタ構成を採用する。

クラスタ数は 2 から$\min(10, 2 + \lfloor n/12 \rfloor)$の範囲で、$n$は参加者数である。この制約により、統計的に意味のあるグループサイズを維持し、後続の統計検定における十分な検定力を確保している。

### 3.3 合意スコアリングと Jeffreys 事前分布による平滑化

グループ認識合意検出は、特定されたクラスタ内での合意確率を推定するためにベイジアンアプローチを使用する。各意見-グループ組み合わせについて、アルゴリズムは Jeffreys 事前分布$\text{Beta}(0.5, 0.5)$を採用し、合意確率を$P(\text{賛成}) = \frac{A + 0.5}{S + 1}$で計算する。ここで A は賛成票数を、S はグループ内の非棄権票の総数を表す。

Jeffreys 事前分布の採用は、変換不変性とフィッシャー情報行列に基づく客観的推論を提供する。この選択により、事前知識の影響を最小化し、データ駆動型の推定を実現している。疑似カウント（賛成 0.5、反対 0.5）は、小標本における極端な確率推定を適切に制御し、境界値（0, 1）での数値的安定性を保証する。

各意見の最終合意スコアは、すべての特定されたグループにわたる合意確率の積を表す。この乗法的アプローチは、意見が単一グループ内での圧倒的支持ではなく、多様な参加者クラスタにわたって広範な支持を示す場合のみ高い合意スコアを達成することを保証する。

### 3.4 統計検定と FDR 制御

代表的コメント識別では、Network Algorithm (Mehta & Patel, 1983) と mid-P 値アプローチを組み合わせた手法を採用している。この特定の組み合わせの利点として、Network Algorithm は従来の Fisher 正確検定における階乗計算による計算爆発を防ぎ、大規模データでの実行可能性を確保する。mid-P 値アプローチは Fisher 正確検定の過度な保守性を緩和し、連続分布に近い検定力を提供する。両者の組み合わせにより、計算効率性と統計的妥当性の両立を実現している。

#### 3.4.1 Network Algorithm による効率的確率計算

Network Algorithm は Fisher 正確確率検定の計算効率化を目的として開発された手法である。この手法により、従来の階乗計算で生じるオーバーフローを回避し、2×2 分割表の確率分布を効率的に算出することができる。

まず範囲最適化として、可能な分割表構成の範囲を$\min(a) = \max(0, k_1 - n_2)$、$\max(a) = \min(n_1, k_1)$で制限する。

次に対数空間計算において、超幾何分布の確率を対数空間で計算することで数値オーバーフローを防止する。最後に効率的累積では、観測値以下の確率を効率的に累積し、正確な p 値を算出する。

#### 3.4.2 mid-P 値アプローチによる保守性緩和

従来の Fisher 正確検定の過度な保守性を緩和するため、mid-P 値アプローチを適用している。

この手法では以下の式により p 値を計算する：

$$\text{mid-P} = P(X < X_{\text{observed}}) + 0.5 \times P(X = X_{\text{observed}})$$

このアプローチにより、離散分布特有の保守的バイアスを軽減し、連続分布における検定力により近い性能を実現している。

### 3.5 多重比較補正による信頼性制御

統計的信頼性を確保するため、Benjamini-Hochberg 法による偽発見率（FDR）制御を実装している。全てのクラスタ × 投稿 × 投票タイプの組み合わせで p 値を収集し、昇順ソート後、各検定の rank i に対して $p_{\text{adj}}(i) = \min(1, \frac{n}{\text{rank}} \times p_i)$ を計算する。単調性保持により、前の調整済み p 値以下に制約する。

デフォルトの FDR 閾値 α = 0.05 を適用し、調整済み p 値がこの閾値未満の場合のみ統計的有意と判定する。この多重比較補正により、複数検定による第 I 種過誤の累積を厳格に制御し、偽陽性発見を統計的に許容可能な水準に抑制している。

代表性スコアは合意率の生の差と統計的信頼度を組み合わせる：代表性 = $(p_{\text{group}} - p_{\text{other}}) \times (1 - p_{\text{adj}})$。この定式化により、多重比較補正後も統計的に有意かつ実質的な差異を示す意見のみが高い代表性スコアを獲得する。

### 3.6 適応的シルエット係数計算による効率化

クラスタリング品質評価において、参加者数に応じて計算手法を適応的に選択する仕組みを実装している。この手法により、統計的精度を維持しながら大幅な計算効率化を実現している。

#### 3.6.1 計算量ベースの手法選択

参加者数 n ≤ 200 の場合には、完全シルエット係数を計算する。各データ点 i について、同一クラスタ内平均距離 a(i)と最近傍クラスタ平均距離 b(i)を算出し、$s(i) = \frac{b(i) - a(i)}{\max(a(i), b(i))}$により個別シルエット値を求める。全点の平均が最終スコアとなる。

参加者数 n > 200 の場合には、近似アルゴリズムに移行する。

#### 3.6.2 層化サンプリング近似

大規模データにおいては、計算量 O(n²)を回避するため、近似手法を適用している。動的サンプルサイズ決定では、サンプルサイズ = $\min(500, \max(100, \sqrt{n}))$により、統計的代表性と計算効率を両立している。

層化サンプリングでは、各クラスタから比例的にサンプルを抽出し、クラスタ構造の代表性を保持する。重心ベース距離近似では、個別点間距離をクラスタ重心との距離で近似することで、計算量を$O(\sqrt{n} + k)$に削減している。

#### 3.6.3 精度保証メカニズム

近似の統計的妥当性は複数の要因により保証されている。√n 法則では、中心極限定理に基づく適切なサンプルサイズ設定により、推定誤差を$O(1/\sqrt{n})$で制御している。層化効果では、各クラスタの構造的特徴を均等に反映することで、バイアスを最小化している。重心近似の妥当性においては、クラスタ内凝集性が高い場合、重心距離は個別点距離の良好な代理指標となる。

この適応的手法により、$n=1000$の場合、計算量を約 100 万回から 32 回に短縮している。
