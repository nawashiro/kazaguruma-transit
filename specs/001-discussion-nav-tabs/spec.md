# Feature Specification: 会話タブナビゲーション修正

**Feature Branch**: `001-discussion-nav-tabs`
**Created**: 2026-01-18
**Status**: Draft
**Input**: User description: "]10;rgb:ffff/ffff/ffffすべてのドキュメント・仕様は日本語で作成してください。 `/discussions/[id]`における、`/discussions/[id]/edit`および`/discussions/[id]/approve`へのナビゲーションを修正したいです。 現状は「あなたは作成者です/あなたはモデレーターです」といったブロック内（以下、「ブロック表示」と表記）にボタンスタイルのリンクがありますね。 レイアウトで作成されたタブナビゲーション（会話、監査ログ）（以下、「タブレイアウト」と表記）に、条件付き（既存のブロック表示で使用されている条件をそのまま使用してください。つまり、作成者であればeditかつapprove、モデレーターであればapprove）で表示してください。 順序は approve -> edit の順です。 既存のブロック表示は無くし、タブレイアウト内の最下部に（GitHubのNoteブロックのような）（色はDaisyUIが定義するinfoを想定）説明を設けます。今までのようなボタンは無く、つねに表示されます。説明を条件付き（ブロック表示で使用されていた条件）で表示します。説明の内容をMarkdownで例示します。実際にはtsxを使用する必要があります。 ```markdown あなたは作成者です。 - ユーザーとして、新しい意見を投稿できます。 - モデレーターとして、投稿を承認できます。 - 作成者として、会話を編集できます（説明を書く、モデレーターを指名するなど）。 ``` ```markdown あなたはモデレーターです。 - ユーザーとして、新しい意見を投稿できます。 - モデレーターとして、投稿を承認できます。 ``` ```markdown あなたはユーザーです。 - ユーザーとして、新しい意見を投稿できます。 ``` `/discussions/[id]/edit`および`/discussions/[id]/approve`に既存の「会話に戻る」は削除してください。"

> **Note**: この仕様は `.specify/memory/constitution.md` の原則に準拠して作成されています。特に、テスト駆動開発(TDD)、アクセシビリティ(WCAG 2.1 AA)、型安全性(TypeScript strict)を重視しています。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 作成者のタブナビゲーション (Priority: P1)

作成者は会話のタブレイアウト上で承認と編集のリンクを確認し、目的のページに移動できる。

**Why this priority**: 作成者が会話の管理行為にすぐ到達できることが主要な価値であるため。

**Independent Test**: 作成者として会話詳細を開き、タブレイアウト内のリンク順序と遷移先を確認するだけで価値を検証できる。

**Acceptance Scenarios**:

1. **Given** 作成者として会話詳細を表示している, **When** タブレイアウトを確認する, **Then** 承認リンクが編集リンクより先に表示される
2. **Given** 作成者として会話詳細を表示している, **When** それぞれのリンクを選択する, **Then** 承認ページと編集ページに到達できる

---

### User Story 2 - モデレーターのタブナビゲーション (Priority: P2)

モデレーターは会話のタブレイアウト上で承認リンクのみを確認し、承認ページに移動できる。

**Why this priority**: モデレーターの主要行為は承認であり、不要な編集導線を排除する必要があるため。

**Independent Test**: モデレーターとして会話詳細を開き、承認リンクの有無と遷移先だけを確認すれば検証できる。

**Acceptance Scenarios**:

1. **Given** モデレーターとして会話詳細を表示している, **When** タブレイアウトを確認する, **Then** 承認リンクは表示され編集リンクは表示されない

---

### User Story 3 - 権限説明の理解 (Priority: P3)

ユーザーはタブレイアウト最下部の説明から、自分に許可された行為を理解できる。

**Why this priority**: 新しい導線の説明が常に表示されることで迷いを減らせるため。

**Independent Test**: 役割ごとに会話詳細を開き、説明文が期待通りに表示されるか確認するだけで検証できる。

**Acceptance Scenarios**:

1. **Given** 作成者として会話詳細を表示している, **When** タブレイアウト最下部を見る, **Then** 作成者向けの説明文が表示される
2. **Given** モデレーターとして会話詳細を表示している, **When** タブレイアウト最下部を見る, **Then** モデレーター向けの説明文が表示される
3. **Given** 一般ユーザーとして会話詳細を表示している, **When** タブレイアウト最下部を見る, **Then** ユーザー向けの説明文が表示される

---

### User Story 4 - 旧導線の撤去 (Priority: P3)

ユーザーは会話詳細および関連ページで旧ブロック表示や不要な戻り導線が表示されない状態を確認できる。

**Why this priority**: 新しい導線の一貫性を保ち、誤解や重複を防ぐため。

**Independent Test**: 該当ページを表示して旧ブロック表示と「会話に戻る」が存在しないことを確認するだけで検証できる。

**Acceptance Scenarios**:

1. **Given** 任意の権限で会話詳細を表示している, **When** タブレイアウト周辺を確認する, **Then** 旧ブロック表示は表示されない
2. **Given** 承認ページを表示している, **When** ページ内の導線を確認する, **Then** 「会話に戻る」が表示されない
3. **Given** 編集ページを表示している, **When** ページ内の導線を確認する, **Then** 「会話に戻る」が表示されない

### Edge Cases

- 作成者かつモデレーターとして扱われる場合、作成者のリンクと説明を優先する
- 権限が明示されない場合は一般ユーザーとして扱う

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 会話詳細のタブレイアウト内に、承認と編集へのリンクを条件付きで表示しなければならない
- **FR-002**: 作成者として扱われる場合、承認リンクと編集リンクの両方を表示しなければならない
- **FR-003**: モデレーターとして扱われる場合、承認リンクのみを表示し、編集リンクは表示してはならない
- **FR-004**: タブレイアウトのリンク表示順は承認→編集の順でなければならない
- **FR-005**: 既存のブロック表示は表示してはならない
- **FR-006**: タブレイアウト最下部に説明ブロックを常時表示しなければならない
- **FR-007**: 説明ブロックの文面は作成者・モデレーター・ユーザーの条件に従って切り替えなければならない
- **FR-008**: 編集ページと承認ページに存在する「会話に戻る」導線を表示してはならない

### Non-Functional Requirements

- **NFR-001**: 主要な画面遷移はユーザーの操作から2秒以内に完了しなければならない
- **NFR-002**: 追加・変更されるUIはWCAG 2.1 AAの要求を満たさなければならない

### Key Entities *(include if feature involves data)*

- **会話**: 個別の会話単位。参加権限と表示条件の判断対象
- **ユーザー権限**: 作成者・モデレーター・一般ユーザーの区分。表示内容を決めるための属性

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 3つの権限パターンのテストで、タブレイアウトのリンク表示が仕様どおりに一致する
- **SC-002**: 3つの権限パターンのテストで、説明ブロックの文面が仕様どおりに一致する
- **SC-003**: 編集ページと承認ページで「会話に戻る」導線が表示されないことを確認できる
- **SC-004**: 会話詳細ページで旧ブロック表示が一切表示されないことを確認できる
- **SC-005**: 主要な画面遷移がユーザー操作から2秒以内に完了する
- **SC-006**: 追加・変更されたUIがWCAG 2.1 AAの観点で問題なく操作できる

## Assumptions

- 作成者として扱われる場合は、モデレーター条件より優先して作成者のリンクと説明が表示される
- 権限が明示されない場合は一般ユーザーとして扱われる
